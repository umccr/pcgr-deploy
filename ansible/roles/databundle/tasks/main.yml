---
- name: Download Google drive downloader
  copy:
    src: scripts/gdown.pl
    dest: "{{ pcgr.mount }}/gdown.pl"
    mode: 0644

# XXX: refactor/loop those two tarballs

- name: Download PCGRs data pack for GRCh37
  command: "perl gdown.pl {{ pcgr.databundle.grch37.url }} {{ pcgr.mount }}/{{ pcgr.databundle.grch37.file }}"
  args:
    chdir: "{{ pcgr.mount }}"
    creates: "{{ pcgr.mount }}/{{ pcgr.databundle.grch37.file }}"

- name: Unpack PCGR data pack for GRCh37
  unarchive:
    remote_src: yes
    src: "{{ pcgr.mount }}/{{ pcgr.databundle.grch37.file }}"
    dest: "{{ pcgr.mount }}/pcgr-{{ pcgr.number_release }}"
    owner: "{{ os_user }}" 
    group: "{{ os_user }}"
    creates: "{{ pcgr.mount }}/pcgr-{{ pcgr.number_release }}/data/grch37/.vep"

- name: Clean tarball for GRCh37
  file:
    state: absent
    path: "{{ pcgr.mount }}/{{ pcgr.databundle.grch37.file }}"

- name: Download PCGRs data pack for GRCh38
  command: "perl gdown.pl {{ pcgr.databundle.grch38.url }} {{ pcgr.mount }}/{{ pcgr.databundle.grch38.file }}"
  args:
    chdir: "{{ pcgr.mount }}"
    creates: "{{ pcgr.mount }}/{{ pcgr.databundle.grch38.file }}"

- name: Unpack PCGR data pack for GRCh38
  unarchive:
    remote_src: yes
    src: "{{ pcgr.mount }}/{{ pcgr.databundle.grch38.file }}"
    dest: "{{ pcgr.mount }}/pcgr-{{ pcgr.number_release }}"
    owner: "{{ os_user }}" 
    group: "{{ os_user }}"
    creates: "{{ pcgr.mount }}/pcgr-{{ pcgr.number_release }}/data/grch38/.vep"

- name: Clean tarball for GRCh38
  file:
    state: absent
    path: "{{ pcgr.mount }}/{{ pcgr.databundle.grch38.file }}"
